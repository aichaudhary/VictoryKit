const express = require('express');
const router = express.Router();
const vulnerabilityController = require('../controllers/vulnerabilityController');

/**
 * Vulnerability Management Routes
 * Base path: /api/v1/iotsecure/vulnerabilities
 */

// Get all vulnerabilities with filtering
router.get('/', vulnerabilityController.getVulnerabilities);

// Get vulnerability statistics
router.get('/stats', vulnerabilityController.getVulnerabilityStats);

// Get critical open vulnerabilities
router.get('/critical', vulnerabilityController.getCriticalVulnerabilities);

// Get exploitable vulnerabilities
router.get('/exploitable', vulnerabilityController.getExploitableVulnerabilities);

// Get vulnerabilities by severity
router.get('/severity/:severity', vulnerabilityController.getBySeverity);

// Get vulnerabilities by device
router.get('/device/:deviceId', vulnerabilityController.getByDevice);

// Search vulnerabilities
router.get('/search', vulnerabilityController.searchVulnerabilities);

// CVE lookup
router.get('/cve/:cveId', vulnerabilityController.lookupCVE);

// Sync with NVD
router.post('/sync/nvd', vulnerabilityController.syncWithNVD);

// Get single vulnerability
router.get('/:id', vulnerabilityController.getVulnerabilityById);

// Create vulnerability
router.post('/', vulnerabilityController.createVulnerability);

// Update vulnerability
router.put('/:id', vulnerabilityController.updateVulnerability);

// Delete vulnerability
router.delete('/:id', vulnerabilityController.deleteVulnerability);

// Vulnerability actions
router.post('/:id/acknowledge', vulnerabilityController.acknowledgeVulnerability);
router.post('/:id/resolve', vulnerabilityController.resolveVulnerability);
router.post('/:id/assign', vulnerabilityController.assignVulnerability);
router.post('/:id/add-note', vulnerabilityController.addNote);

// Bulk operations
router.post('/bulk/acknowledge', vulnerabilityController.bulkAcknowledge);
router.post('/bulk/resolve', vulnerabilityController.bulkResolve);

// Export
router.get('/export/csv', vulnerabilityController.exportCSV);
router.get('/export/json', vulnerabilityController.exportJSON);

module.exports = router;
