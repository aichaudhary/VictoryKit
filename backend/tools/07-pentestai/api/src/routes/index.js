const express = require('express');
const router = express.Router();

const targetController = require('../controllers/targetController');
const testController = require('../controllers/testController');
const findingController = require('../controllers/findingController');
const engagementController = require('../controllers/engagement.controller');
const exploitController = require('../controllers/exploit.controller');

// ==========================================
// ENGAGEMENT ROUTES
// ==========================================

// Engagement CRUD
router.post('/engagements', engagementController.createEngagement);
router.get('/engagements', engagementController.getEngagements);
router.get('/engagements/stats', engagementController.getStats);
router.get('/engagements/:id', engagementController.getEngagement);
router.put('/engagements/:id', engagementController.updateEngagement);
router.delete('/engagements/:id', engagementController.deleteEngagement);
router.patch('/engagements/:id/status', engagementController.updateStatus);

// Engagement Team Management
router.post('/engagements/:id/team', engagementController.addTeamMember);
router.delete('/engagements/:id/team/:memberId', engagementController.removeTeamMember);

// Engagement Findings
router.post('/engagements/:id/findings', engagementController.addFinding);
router.get('/engagements/:id/findings', engagementController.getFindings);

// Attack Paths within Engagement
router.post('/engagements/:id/attack-paths', engagementController.createAttackPath);
router.post('/engagements/:id/attack-paths/:pathId/execute', engagementController.executeAttackPath);
router.get('/engagements/:id/attack-paths/:pathId/status', engagementController.getAttackPathStatus);

// Engagement Reports
router.get('/engagements/:id/report', engagementController.generateReport);

// ==========================================
// EXPLOIT ROUTES
// ==========================================

// Exploit Search & Info
router.get('/exploits', exploitController.searchExploits);
router.get('/exploits/stats', exploitController.getExploitStats);
router.get('/exploits/:id', exploitController.getExploitDetails);

// Exploit Execution
router.post('/exploits/:id/execute', exploitController.executeExploit);
router.post('/exploits/recommend', exploitController.getRecommendedExploits);
router.post('/exploits/sync-metasploit', exploitController.syncFromMetasploit);

// Payload Generation
router.post('/payloads/generate', exploitController.generatePayload);

// Exploit Module Management
router.post('/exploits', exploitController.createExploitModule);
router.delete('/exploits/:id', exploitController.deleteExploitModule);

// ==========================================
// RECONNAISSANCE ROUTES
// ==========================================

router.post('/recon', exploitController.runRecon);
router.post('/recon/ports', exploitController.portScan);
router.post('/recon/services', exploitController.serviceDetection);
router.post('/recon/os', exploitController.osFingerprint);
router.post('/recon/web', exploitController.webRecon);

// ==========================================
// ATTACK ROUTES
// ==========================================

router.post('/attacks/sqli', exploitController.sqlInjection);
router.post('/attacks/bruteforce', exploitController.bruteForce);

// ==========================================
// LEGACY ROUTES (backward compatibility)
// ==========================================

// Target routes
router.post('/targets', targetController.create);
router.get('/targets', targetController.list);
router.get('/targets/:id', targetController.get);
router.put('/targets/:id', targetController.update);
router.delete('/targets/:id', targetController.delete);

// Test routes
router.post('/tests', testController.create);
router.get('/tests', testController.list);
router.get('/tests/:id', testController.get);
router.post('/tests/:id/execute', testController.execute);
router.get('/tests/:id/status', testController.status);

// Finding routes
router.get('/findings', findingController.list);
router.get('/findings/:id', findingController.get);
router.put('/findings/:id/verify', findingController.verify);
router.post('/findings/:id/exploit', findingController.exploit);
router.get('/reports/:testId', findingController.report);

module.exports = router;
